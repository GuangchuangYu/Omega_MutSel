/* 
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Run across 8 sets of equilibrium freqs: Fequal, Fnull, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. 
NOTE: Fnull refers to frequencies which would exist in the absence of natural selection. 
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

Fnull_CodonFreqs = {{0.0576983443548},{0.0178623287322},{0.0105319728082},{0.0678586010545},{0.0178623287322},{0.00552222202079},{0.00326287789486},{0.0209803898195},{0.0105319728082},{0.00326287789486},{0.0019163408744},{0.0123956892731},{0.0678586010545},{0.0209803898195},{0.0123956892731},{0.0797101896698},{0.016656776867},{0.00550938458351},{0.00301284076274},{0.0208985183277},{0.00550938458351},{0.00170636736722},{0.00100748665802},{0.00648261784471},{0.00301284076274},{0.00100748665802},{0.000495744452809},{0.00382119128245},{0.0208985183277},{0.00648261784471},{0.00382119128245},{0.0246286196663},{0.0110330778178},{0.00326881252872},{0.00201073890535},{0.0124138336682},{0.00326881252872},{0.00100886478209},{0.000596992336277},{0.00383288097333},{0.00201073890535},{0.000596992336277},{0.000358822780659},{0.00226728989147},{0.0124138336682},{0.00383288097333},{0.00226728989147},{0.0145619520645},{0.0210106323647},{0.0794524195248},{0.0210106323647},{0.00648393807125},{0.00385127114388},{0.0246314283336},{0.00385127114388},{0.00162336534621},{0.0145496436533},{0.0794524195248},{0.0246314283336},{0.0145496436533},{0.0935756891342}};

F61_CodonFreqs_site = DATAFREQS

F61_CodonFreqs_global = {{0.0658980266826},{0.0190980345093},{0.0125857102076},{0.072349648091},{0.0210171897485},{0.00639141874678},{0.00384026978991},{0.0242807457662},{0.0210622090622},{0.00420643998084},{0.00406483237882},{0.0159297041123},{0.0638000297411},{0.0183735246636},{0.0139628462019},{0.0698366867892},{0.0182849984315},{0.00466208605275},{0.00346875997338},{0.0176638732659},{0.00492059634909},{0.001523211736},{0.000903157403057},{0.0057863328958},{0.00512747727706},{0.00174366482802},{0.000919510926147},{0.00662577003547},{0.0209665374133},{0.00646009947811},{0.00391109537835},{0.0245361497935},{0.012814071735},{0.0032004656305},{0.00244560551775},{0.0121239466572},{0.00536653684769},{0.00164149287406},{0.000980975308666},{0.00623578423683},{0.0032463035022},{0.000981488590594},{0.000591873778875},{0.00372654975179},{0.0132435940758},{0.00400634967157},{0.0024193390934},{0.015219017099},{0.014986930627},{0.0566508200549},{0.0282138336754},{0.00870744628024},{0.0051908162612},{0.0330723232855},{0.00334643689084},{0.00119140937619},{0.0126433880064},{0.0793412947578},{0.0186147553317},{0.0150255793603},{0.0705709340124}};

HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.047395591},{0.015386285},{0.0093281006},{0.058347495},{0.023690901},{0.0076909042},{0.0046626934},{0.02916526},{0.01280023},{0.0041554071},{0.0025192603},{0.015758034},{0.065988342},{0.021422149},{0.012987408},{0.081236554},{0.01383823},{0.0044923788},{0.002723553},{0.01703589},{0.0069171021},{0.0022455359},{0.0013613803},{0.0085154669},{0.0037373207},{0.0012132664},{0.00073555584},{0.0046009196},{0.01926681},{0.0062546879},{0.0037919718},{0.023718876},{0.0095771657},{0.0031090866},{0.0018849172},{0.011790203},{0.0047871897},{0.0015540911},{0.00094218442},{0.0058933864},{0.0025865258},{0.00083967775},{0.00050906367},{0.0031842056},{0.013334179},{0.0043287459},{0.0026243488},{0.016415365},{0.012245488},{0.046437043},{0.018854886},{0.0061209628},{0.0037108995},{0.023211767},{0.0033071654},{0.0020050046},{0.012541353},{0.052518166},{0.017049254},{0.010336293},{0.064653766}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.053750763},{0.014264819},{0.010112972},{0.054094659},{0.021635679},{0.005741854},{0.0040706588},{0.021774103},{0.013980659},{0.003710302},{0.0026304001},{0.014070107},{0.060262395},{0.015992929},{0.011338107},{0.060647953},{0.01569358},{0.0041648911},{0.0029526787},{0.015793987},{0.0063169568},{0.0016764459},{0.0011885079},{0.0063573726},{0.004081925},{0.0010832948},{0.00076799643},{0.0041080411},{0.017594777},{0.0046694465},{0.0033103808},{0.017707348},{0.010861274},{0.002882454},{0.0020435014},{0.010930764},{0.0043718641},{0.0011602412},{0.0008225472},{0.0043998352},{0.0028250346},{0.00074973087},{0.00053151796},{0.0028431091},{0.012177062},{0.0032316487},{0.0022910612},{0.012254971},{0.014397723},{0.054598656},{0.021837257},{0.0057953506},{0.0041085849},{0.021976972},{0.0037448707},{0.0026549074},{0.014201197},{0.060823857},{0.016141935},{0.011443744},{0.061213007}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn = (filt_data, Tree01);
Optimize (paramValues, LikFn);
fprintf ("equal_hyout.txt", LikFn);


////////////// NULL FREQUENCIES //////////////
Model MyModel = (GY94, Fnull_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("null_hyout.txt", LikFn1);

////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

