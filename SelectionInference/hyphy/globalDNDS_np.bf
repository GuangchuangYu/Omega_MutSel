/* 
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Run across 8 sets of equilibrium freqs: Fequal, Fnull, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. 
NOTE: Fnull refers to frequencies which would exist in the absence of natural selection. 
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

Fnull_CodonFreqs = {{0.0159744555101},{0.0162616273648},{0.0162584125995},{0.015950404186},{0.0162616273648},{0.0165554372266},{0.0165599318572},{0.0162499968371},{0.0162584125995},{0.0165599318572},{0.0165258239283},{0.0162427541962},{0.015950404186},{0.0162499968371},{0.0162427541962},{0.0159498055864},{0.0159810637454},{0.0165160769394},{0.0162769960766},{0.0161666474214},{0.0165160769394},{0.0168416529064},{0.016823753332},{0.0165250436193},{0.0162769960766},{0.016823753332},{0.0166148969851},{0.0164766049448},{0.0161666474214},{0.0165250436193},{0.0164766049448},{0.0162143431321},{0.016425557835},{0.0165924095857},{0.0167029140915},{0.0162690420722},{0.0165924095857},{0.0168721422871},{0.0168940590607},{0.016559997581},{0.0167029140915},{0.0168940590607},{0.0168842653373},{0.0165622079158},{0.0162690420722},{0.016559997581},{0.0165622079158},{0.0162529412102},{0.0163380426741},{0.0158455302574},{0.0163380426741},{0.0165636807244},{0.0166423313189},{0.0162419356376},{0.0166423313189},{0.0161273090386},{0.0161881807798},{0.0158455302574},{0.0162419356376},{0.0161881807798},{0.0159268238491}};

F61_CodonFreqs_site = DATAFREQS

F61_CodonFreqs_global = {{0.017274122406},{0.0165289044056},{0.0178110465444},{0.0160481777078},{0.0165440302014},{0.0168247775624},{0.0168554874281},{0.0165038458249},{0.0200679091543},{0.0181013815289},{0.0206754445263},{0.017558678789},{0.0164871224637},{0.0166462890039},{0.0173729848651},{0.0162567427401},{0.0155233995997},{0.0131009968735},{0.0159735514944},{0.0127411086481},{0.0106387025502},{0.0108436972708},{0.0108415639061},{0.0106397457816},{0.0197065093418},{0.0202521359352},{0.0201287408928},{0.0198549102606},{0.017215404483},{0.0175145854924},{0.0175783292453},{0.0171865440495},{0.0156850442726},{0.0136527780793},{0.0161527396802},{0.0132610406112},{0.0197188518977},{0.0200716076979},{0.0200875621772},{0.0196974866951},{0.0185883425154},{0.0188952460818},{0.0188949053976},{0.0185130475514},{0.0156929188991},{0.0159927570671},{0.0159780563508},{0.0156862465877},{0.012581752079},{0.012125389635},{0.0178623254559},{0.0181568015369},{0.018202541326},{0.0178066149475},{0.0139415063448},{0.0108684811772},{0.0134699264357},{0.0166776296994},{0.0138377888856},{0.0171530917999},{0.0134506481382}};

HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.013316665},{0.014395917},{0.014263133},{0.014051686},{0.016692017},{0.018044826},{0.017878385},{0.017613343},{0.017217056},{0.018612417},{0.01844074},{0.018167362},{0.016655605},{0.018005463},{0.017839384},{0.017574921},{0.011982196},{0.012953297},{0.012833818},{0.012643561},{0.015019303},{0.016236546},{0.016086784},{0.015848302},{0.015491728},{0.016747259},{0.016592786},{0.016346803},{0.01498654},{0.016201128},{0.016051692},{0.015813731},{0.01326931},{0.014344725},{0.014212412},{0.014001718},{0.016632659},{0.017980658},{0.017814808},{0.017550709},{0.017155832},{0.01854623},{0.018375164},{0.018102758},{0.016596377},{0.017941434},{0.017775947},{0.017512424},{0.01017293},{0.0099296772},{0.011795477},{0.012751445},{0.012633828},{0.012446535},{0.013152535},{0.013031219},{0.012838035},{0.011769746},{0.012723628},{0.012606269},{0.012419384}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.014817155},{0.014167737},{0.014810736},{0.013829017},{0.016368727},{0.015651305},{0.016361636},{0.015277116},{0.017948818},{0.017162143},{0.017941043},{0.016751833},{0.01633308},{0.015617221},{0.016326005},{0.015243847},{0.013332015},{0.012747689},{0.01332624},{0.01244292},{0.014728071},{0.014082558},{0.014721692},{0.013745874},{0.016149788},{0.015441963},{0.016142793},{0.015072779},{0.014695998},{0.01405189},{0.014689632},{0.01371594},{0.014764194},{0.014117097},{0.014757799},{0.013779588},{0.01631022},{0.015595363},{0.016303155},{0.015222512},{0.017884664},{0.0171008},{0.017876917},{0.016691958},{0.016274701},{0.0155614},{0.016267651},{0.015189361},{0.012312202},{0.012017844},{0.01422493},{0.013601469},{0.014218768},{0.013276287},{0.014914433},{0.015591322},{0.014557862},{0.014193952},{0.013571848},{0.014187804},{0.013247375}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn = (filt_data, Tree01);
Optimize (paramValues, LikFn);
fprintf ("equal_hyout.txt", LikFn);


////////////// NULL FREQUENCIES //////////////
Model MyModel = (GY94, Fnull_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("null_hyout.txt", LikFn1);

////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

