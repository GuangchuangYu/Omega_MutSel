/* Hyphy inference specifically for the NP dataset.
Run across 7 sets of equilibrium freqs: Fequal, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. */

global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. */

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

F61_CodonFreqs_site = DATAFREQS
F61_CodonFreqs_global = {{0.01772504}, {0.01653378}, {0.01772504}, {0.01653378}, {0.01672377}, {0.01672377}, {0.01672377}, {0.01672377}, {0.02004847}, {0.01785777}, {0.02004847}, {0.01785777}, {0.01675554}, {0.01675554}, {0.01747054}, {0.01675554}, {0.0160197}, {0.01302744}, {0.0160197}, {0.01302744}, {0.01060755}, {0.01060755}, {0.01060755}, {0.01060755}, {0.02004847}, {0.02004847}, {0.02004847}, {0.02004847}, {0.01736432}, {0.01736432}, {0.01736432}, {0.01736432}, {0.01575823}, {0.0133861}, {0.01575823}, {0.0133861}, {0.01958093}, {0.01958093}, {0.01958093}, {0.01958093}, {0.01841006}, {0.01841006}, {0.01841006}, {0.01841006}, {0.01580762}, {0.01580762}, {0.01580762}, {0.01580762}, {0.01255992}, {0.01255992}, {0.01785777}, {0.01785777}, {0.01785777}, {0.01785777}, {0.01367906}, {0.01105114}, {0.01367906}, {0.01736432}, {0.01384508}, {0.01736432}, {0.01384508}};


HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.01364568853703291}, {0.01448021495488633}, {0.01435322799399837}, {0.01446569402438121}, {0.01670492472203402}, {0.01772654418454459}, {0.01757108793061088}, {0.01770876779676294}, {0.01732725744008725}, {0.01838693676982258}, {0.01822568907925215}, {0.01836849813256004}, {0.01704732098604875}, {0.01808988030270586}, {0.01793123770453831}, {0.01807173955717549}, {0.01226688657331034}, {0.01301708989815224}, {0.01290293408686616}, {0.01300403620672715}, {0.0150170082092051}, {0.01593540012718658}, {0.01579565164700243}, {0.01591941991981126}, {0.01557645853247028}, {0.0165290646326804}, {0.01638410990027039}, {0.01651248909153037}, {0.01532480771103274}, {0.01626202365647023}, {0.01611941078998605}, {0.01624571590716374}, {0.01341042647795147}, {0.01423056502502145}, {0.0141057674160166}, {0.01421629444641327}, {0.01641691910207279}, {0.01742092506727279}, {0.01726814899750848}, {0.01740345515794996}, {0.01702852233027392}, {0.01806993198161208}, {0.01791146432398779}, {0.01805181124049361}, {0.01675341219382359}, {0.01777799699414277}, {0.01762208951514504}, {0.01776016900887621}, {0.01017440244312114}, {0.01016419943223574}, {0.01173757623305613}, {0.01245540864008128}, {0.01234617859793416}, {0.0124429182092528}, {0.01291942799020868}, {0.01280612864334133}, {0.01290647223529784}, {0.01197815811640251}, {0.01271070373755127}, {0.01259923483716494}, {0.01269795729378512}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.01516957278691112}, {0.01423348669161201}, {0.0148961242509082}, {0.0142192464803957}, {0.01636597398263608}, {0.01535606019690368}, {0.01607095897537925}, {0.01534069688182901}, {0.01805726912070687}, {0.01694298866070918}, {0.01773176662471512}, {0.01692603766743595}, {0.01670144615896973}, {0.01567083100978848}, {0.01640038389008089}, {0.01565515277518936}, {0.01363678826951601}, {0.01279528745318147}, {0.01339096989081398}, {0.01278248612067211}, {0.01471230107535945}, {0.0138044323660718}, {0.014447095373999}, {0.01379062141188514}, {0.01623270207960088}, {0.01523101225489083}, {0.01594008944763089}, {0.01521577404683631}, {0.01501387601772849}, {0.01408739768019304}, {0.01474323409033554}, {0.01407330362700701}, {0.0149085380509985}, {0.01398855992328097}, {0.01463979495841076}, {0.01397456475454715}, {0.01608435183305278}, {0.01509181642587173}, {0.01579441338039582}, {0.01507671747940846}, {0.01774654352925884}, {0.01665143736702774}, {0.01742664220999591}, {0.01663477806278984}, {0.0164140512765491}, {0.01540117073051542}, {0.0161181696222337}, {0.01538576228359494}, {0.01232075302125778}, {0.01230842644737127}, {0.01416667101752514}, {0.01329247212330022}, {0.01391130090894043}, {0.01327917337122886}, {0.01466614493366467}, {0.01534892482405195}, {0.01465147185979953}, {0.01445706155356622}, {0.01356494319998585}, {0.0141964568303971}, {0.01355137184811049}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("equal_hyout.txt", LikFn1);


////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

