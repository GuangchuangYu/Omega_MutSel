/* 
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Run across 8 sets of equilibrium freqs: Fequal, Fnull, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. 
NOTE: Fnull refers to frequencies which would exist in the absence of natural selection. 
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

Fnull_CodonFreqs = {{0.0159744555101},{0.0162616273648},{0.0162584125995},{0.015950404186},{0.0162616273648},{0.0165554372266},{0.0165599318572},{0.0162499968371},{0.0162584125995},{0.0165599318572},{0.0165258239283},{0.0162427541962},{0.015950404186},{0.0162499968371},{0.0162427541962},{0.0159498055864},{0.0159810637454},{0.0165160769394},{0.0162769960766},{0.0161666474214},{0.0165160769394},{0.0168416529064},{0.016823753332},{0.0165250436193},{0.0162769960766},{0.016823753332},{0.0166148969851},{0.0164766049448},{0.0161666474214},{0.0165250436193},{0.0164766049448},{0.0162143431321},{0.016425557835},{0.0165924095857},{0.0167029140915},{0.0162690420722},{0.0165924095857},{0.0168721422871},{0.0168940590607},{0.016559997581},{0.0167029140915},{0.0168940590607},{0.0168842653373},{0.0165622079158},{0.0162690420722},{0.016559997581},{0.0165622079158},{0.0162529412102},{0.0163380426741},{0.0158455302574},{0.0163380426741},{0.0165636807244},{0.0166423313189},{0.0162419356376},{0.0166423313189},{0.0161273090386},{0.0161881807798},{0.0158455302574},{0.0162419356376},{0.0161881807798},{0.0159268238491}};

F61_CodonFreqs_site = DATAFREQS

F61_CodonFreqs_global = {{0.0173880423911},{0.0164372409044},{0.0176845917926},{0.016179443123},{0.0165702162599},{0.0168751388119},{0.0168612911336},{0.0165827548563},{0.0199979635366},{0.0180027537136},{0.0203125372928},{0.0176880736391},{0.0163758084812},{0.0167143522038},{0.0173526899538},{0.0164437371434},{0.0156511101308},{0.0130772197091},{0.0159224609163},{0.0128498732629},{0.0106227264548},{0.0108344522986},{0.01081450703},{0.0106444749742},{0.0197901564963},{0.0202601728735},{0.0202050806618},{0.0199553363572},{0.0171833970119},{0.0175374850869},{0.0175077803752},{0.0172743615653},{0.0157897439053},{0.013556624406},{0.0160378523109},{0.0133340555461},{0.0196892065367},{0.0200289084326},{0.0200352555623},{0.019673148356},{0.0185637905668},{0.0188040208476},{0.0187655715723},{0.0184725385329},{0.0156897236367},{0.0159838890203},{0.0159669587933},{0.0157103221199},{0.0125903322176},{0.0122313072727},{0.0178324018031},{0.0180708983565},{0.0181472935433},{0.0177427793393},{0.0138471019339},{0.0108928661228},{0.0135039399668},{0.0168857823934},{0.0137964123905},{0.0172136423613},{0.0135464017113}};

HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.013348898},{0.014379942},{0.014228917},{0.014122868},{0.016693333},{0.017982695},{0.017793832},{0.017661214},{0.017207453},{0.018536525},{0.018341845},{0.018205143},{0.016703438},{0.01799358},{0.017804603},{0.017671904},{0.012033622},{0.012963077},{0.012826932},{0.012731333},{0.015048528},{0.016210849},{0.016040594},{0.015921043},{0.015511992},{0.01671011},{0.016534612},{0.016411378},{0.015057637},{0.016220661},{0.016050304},{0.01593068},{0.013283276},{0.014309252},{0.014158969},{0.014053441},{0.01661127},{0.017894294},{0.017706359},{0.017574393},{0.017122863},{0.018445401},{0.018251679},{0.018115648},{0.016621325},{0.017905126},{0.017717077},{0.017585031},{0.010173399},{0.0099915269},{0.011810058},{0.012722245},{0.012588629},{0.012494806},{0.013114064},{0.012976333},{0.01287962},{0.011817206},{0.012729946},{0.012596249},{0.012502369}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.01485174},{0.014149784},{0.014774584},{0.013896881},{0.016368678},{0.015595025},{0.016283641},{0.015316291},{0.017940001},{0.017092081},{0.017846801},{0.016786589},{0.016378644},{0.015604521},{0.016293556},{0.015325617},{0.013388054},{0.012755278},{0.013318502},{0.012527299},{0.014755493},{0.014058086},{0.014678836},{0.013806822},{0.016171957},{0.015407602},{0.016087942},{0.015132217},{0.014764477},{0.014066646},{0.014687774},{0.013815229},{0.014778437},{0.014079946},{0.014701662},{0.013828291},{0.016287888},{0.015518054},{0.016203271},{0.015240695},{0.017851455},{0.01700772},{0.017758715},{0.016703737},{0.016297805},{0.015527502},{0.016213137},{0.015249975},{0.012311413},{0.012091368},{0.014242023},{0.013568885},{0.014168035},{0.013326365},{0.01487144},{0.015528105},{0.014605639},{0.014250695},{0.013577147},{0.014176662},{0.013334479}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn = (filt_data, Tree01);
Optimize (paramValues, LikFn);
fprintf ("equal_hyout.txt", LikFn);


////////////// NULL FREQUENCIES //////////////
Model MyModel = (GY94, Fnull_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("null_hyout.txt", LikFn1);

////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

