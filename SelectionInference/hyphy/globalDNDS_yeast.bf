/* 
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Run across 8 sets of equilibrium freqs: Fequal, Fnull, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. 
NOTE: Fnull refers to frequencies which would exist in the absence of natural selection. 
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

Fnull_CodonFreqs = {{0.0415420976134},{0.019859659982},{0.0199226668741},{0.0418410026486},{0.019859659982},{0.00952086207663},{0.00952773729476},{0.0199841786885},{0.0199226668741},{0.00952773729476},{0.00960027733595},{0.0200172808268},{0.0418410026486},{0.0199841786885},{0.0200172808268},{0.0418563181783},{0.0212103555792},{0.00960702697888},{0.0100649760394},{0.0202818863501},{0.00960702697888},{0.00456888973382},{0.00459672580976},{0.00960216068013},{0.0100649760394},{0.00459672580976},{0.00472709614948},{0.00965950242228},{0.0202818863501},{0.00960216068013},{0.00965950242228},{0.0201068649502},{0.0189747676791},{0.00936938936388},{0.00917571428658},{0.0199620548488},{0.00936938936388},{0.00452903599734},{0.00451834486019},{0.0095442790625},{0.00917571428658},{0.00451834486019},{0.0045759964321},{0.00956040435674},{0.0199620548488},{0.0095442790625},{0.00956040435674},{0.0200222354502},{0.0189970705278},{0.0428338830373},{0.0189970705278},{0.00937204102203},{0.00925761483226},{0.0200028931788},{0.00925761483226},{0.0105071511614},{0.0202173800273},{0.0428338830373},{0.0200028931788},{0.0202173800273},{0.0420783446859}};

F61_CodonFreqs_site = DATAFREQS

F61_CodonFreqs_global = {{0.043290480867},{0.0188472313944},{0.0193545856332},{0.0420950331717},{0.0211606018004},{0.0101401150859},{0.0101019121973},{0.0214678453666},{0.0273822028831},{0.0106683058196},{0.012250248782},{0.0239101248661},{0.0377141651232},{0.0183903315529},{0.020684945186},{0.0394423155306},{0.0217845918205},{0.00774771537914},{0.00977427199326},{0.0170464058066},{0.00726263656558},{0.0034510319783},{0.00345813818133},{0.00726019611744},{0.0149794076361},{0.00690924671313},{0.00697640963953},{0.0144660098607},{0.0200427088827},{0.00962866611965},{0.00945871585698},{0.0202951867294},{0.0194304451535},{0.00750138713285},{0.00873151982915},{0.0167730955518},{0.0130008082228},{0.00622743019523},{0.00622058756301},{0.0131146195545},{0.0125594406824},{0.00603500577388},{0.00607281205363},{0.0127906523446},{0.0192647962792},{0.00914754678407},{0.00918270275692},{0.0192518095131},{0.0133533353384},{0.0312176902037},{0.0222307097398},{0.0107391095205},{0.0106832235699},{0.0228261705635},{0.00765284954925},{0.00718355907153},{0.0174058347007},{0.04505341036},{0.0151772893843},{0.0202383995281},{0.0334919745395}};

HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.032316204},{0.016062393},{0.015938954},{0.035069118},{0.022094278},{0.010981703},{0.01089731},{0.023976419},{0.021848651},{0.010859617},{0.010776162},{0.023709868},{0.040428073},{0.020094303},{0.019939879},{0.043872012},{0.015480009},{0.0076941579},{0.0076350288},{0.016798701},{0.010583533},{0.0052604217},{0.0052199958},{0.01148511},{0.010465874},{0.0052019405},{0.005161964},{0.011357428},{0.019365731},{0.0096255111},{0.0095515397},{0.021015436},{0.015888571},{0.007897229},{0.0078365394},{0.017242068},{0.010862863},{0.0053992595},{0.0053577666},{0.011788236},{0.010742098},{0.0053392348},{0.0052982031},{0.011657183},{0.019876849},{0.0098795562},{0.0098036325},{0.021570094},{0.010963411},{0.023936481},{0.015080484},{0.0074955787},{0.0074379757},{0.016365142},{0.0074122487},{0.0073552861},{0.016183207},{0.027594244},{0.013715398},{0.013609996},{0.02994491}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.03585709},{0.015043486},{0.016499066},{0.032844338},{0.020542046},{0.0086182115},{0.0094520939},{0.018816081},{0.022849707},{0.0095863676},{0.010513927},{0.020929849},{0.037587491},{0.015769459},{0.017295283},{0.034429349},{0.017176134},{0.0072060764},{0.0079033233},{0.015732976},{0.0098399769},{0.0041282646},{0.004527708},{0.0090132112},{0.010945384},{0.0045920272},{0.0050363434},{0.010025741},{0.018005025},{0.0075538292},{0.008284724},{0.016492222},{0.017629535},{0.0073962965},{0.0081119487},{0.016148282},{0.010099725},{0.0042372391},{0.0046472266},{0.0092511345},{0.011234311},{0.0047132438},{0.0051692887},{0.010290392},{0.018480306},{0.0077532289},{0.0085034173},{0.016927571},{0.013339013},{0.029122974},{0.01821457},{0.0076417417},{0.0083811428},{0.016684161},{0.0085002028},{0.009322667},{0.018558433},{0.033328714},{0.013982731},{0.015335674},{0.030528398}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn = (filt_data, Tree01);
Optimize (paramValues, LikFn);
fprintf ("equal_hyout.txt", LikFn);


////////////// NULL FREQUENCIES //////////////
Model MyModel = (GY94, Fnull_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("null_hyout.txt", LikFn1);

////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

