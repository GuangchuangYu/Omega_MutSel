/* 
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Run across 8 sets of equilibrium freqs: Fequal, Fnull, F61_site, F3x4_site, CF3x4_site, F61_global, F3x4_global, CF3x4_global. 
NOTE: Fnull refers to frequencies which would exist in the absence of natural selection. 
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;

/* Include relevant functions */
#include "matrices.mdl"; //rate matrices
#include "GY94_Header.ibf";

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");



/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal_CodonFreqs = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

Fnull_CodonFreqs = {{0.0415420976134},{0.019859659982},{0.0199226668741},{0.0418410026486},{0.019859659982},{0.00952086207663},{0.00952773729476},{0.0199841786885},{0.0199226668741},{0.00952773729476},{0.00960027733595},{0.0200172808268},{0.0418410026486},{0.0199841786885},{0.0200172808268},{0.0418563181783},{0.0212103555792},{0.00960702697888},{0.0100649760394},{0.0202818863501},{0.00960702697888},{0.00456888973382},{0.00459672580976},{0.00960216068013},{0.0100649760394},{0.00459672580976},{0.00472709614948},{0.00965950242228},{0.0202818863501},{0.00960216068013},{0.00965950242228},{0.0201068649502},{0.0189747676791},{0.00936938936388},{0.00917571428658},{0.0199620548488},{0.00936938936388},{0.00452903599734},{0.00451834486019},{0.0095442790625},{0.00917571428658},{0.00451834486019},{0.0045759964321},{0.00956040435674},{0.0199620548488},{0.0095442790625},{0.00956040435674},{0.0200222354502},{0.0189970705278},{0.0428338830373},{0.0189970705278},{0.00937204102203},{0.00925761483226},{0.0200028931788},{0.00925761483226},{0.0105071511614},{0.0202173800273},{0.0428338830373},{0.0200028931788},{0.0202173800273},{0.0420783446859}};

F61_CodonFreqs_site = DATAFREQS

F61_CodonFreqs_global = {{0.0425878663474},{0.0199078643132},{0.0206080077075},{0.0410957486733},{0.0211288327264},{0.0101737510099},{0.0102015024614},{0.0211244049354},{0.0281069065528},{0.0113126700256},{0.0135933116374},{0.0233415011914},{0.038607136559},{0.0183427368963},{0.0208081941436},{0.0378467556072},{0.0212454327197},{0.00799840204442},{0.0102324620869},{0.0165134584925},{0.00727186274848},{0.00347178512148},{0.00349349462},{0.00721584392773},{0.0144718989509},{0.00684780307396},{0.00682240822034},{0.0139887873167},{0.0205386820914},{0.00972918740468},{0.0097893064169},{0.0198883449017},{0.0190032600421},{0.00794583686669},{0.00925901840985},{0.0165008466301},{0.0130669480887},{0.00632403196468},{0.00631782177592},{0.0132104311994},{0.012572795276},{0.00617384774217},{0.00622587915583},{0.0128712793025},{0.0193448210618},{0.00925162260606},{0.00926846715473},{0.0191727272757},{0.0136570776602},{0.03037549023},{0.0221599938113},{0.010960463496},{0.0108055448481},{0.0230642639634},{0.00804200517678},{0.00718219624967},{0.017182851242},{0.0429633607131},{0.0156993564494},{0.0205206463864},{0.0325707642958}};

HarvestFrequencies(posFreqs,filt_data,3,1,1);
F3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs);
F3x4_CodonFreqs_global  = {{0.032273773},{0.016566844},{0.016495717},{0.034560719},{0.022141872},{0.011365914},{0.011317117},{0.023710863},{0.021995729},{0.011290896},{0.01124242},{0.023554364},{0.040130198},{0.020599721},{0.02051128},{0.042973856},{0.015295299},{0.0078514162},{0.0078177076},{0.016379136},{0.010493553},{0.0053865735},{0.0053634473},{0.011237134},{0.010424292},{0.0053510205},{0.0053280468},{0.011162966},{0.019018643},{0.0097626914},{0.0097207771},{0.020366319},{0.01589112},{0.0081572645},{0.0081222427},{0.017017177},{0.010902324},{0.005596405},{0.0055723778},{0.011674872},{0.010830366},{0.0055594669},{0.0055355984},{0.011597814},{0.019759505},{0.010142992},{0.010099445},{0.02115968},{0.01116077},{0.023282904},{0.014916561},{0.0076570018},{0.0076241279},{0.015973561},{0.0076064632},{0.0075738062},{0.01586813},{0.027034957},{0.013877643},{0.013818062},{0.028950676}};

posFreqs_cf3x4 = CF3x4(posFreqs, "TAA,TAG,TGA");
CF3x4_CodonFreqs_site = BuildCodonFrequencies(posFreqs_cf3x4);
CF3x4_CodonFreqs_global = {{0.03579975},{0.015524472},{0.017071935},{0.032385926},{0.02059033},{0.0089289449},{0.0098189732},{0.018626859},{0.022968838},{0.0099603792},{0.01095322},{0.020778556},{0.03731822},{0.016182952},{0.017796053},{0.033759597},{0.016966345},{0.0073574128},{0.0080907923},{0.015348453},{0.0097582423},{0.0042316373},{0.0046534427},{0.0088277074},{0.010885474},{0.0047204583},{0.0051909888},{0.0098474471},{0.017685983},{0.0076694823},{0.0084339686},{0.015999468},{0.017627291},{0.0076440306},{0.0084059798},{0.015946373},{0.010138388},{0.0043964863},{0.0048347237},{0.0091716024},{0.011309532},{0.00490435},{0.0053932107},{0.010231067},{0.018374964},{0.0079682572},{0.008762525},{0.016622748},{0.013598075},{0.028367229},{0.018035322},{0.0078209722},{0.0086005588},{0.016315494},{0.008724418},{0.0095940592},{0.018200191},{0.032687486},{0.014174846},{0.015587781},{0.029570444}};


/* Optimize likelihoods for each frequency specification */

////////////// EQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn = (filt_data, Tree01);
Optimize (paramValues, LikFn);
fprintf ("equal_hyout.txt", LikFn);


////////////// NULL FREQUENCIES //////////////
Model MyModel = (GY94, Fnull_CodonFreqs, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("null_hyout.txt", LikFn1);

////////////// DATA FREQUENCIES, SITE //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_site_hyout.txt", LikFn2);

////////////// DATA FREQUENCIES, GLOBAL //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_global_hyout.txt", LikFn3);



////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_site_hyout.txt", LikFn4);

////////////// F3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_global_hyout.txt", LikFn5);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_site, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("cf3x4_site_hyout.txt", LikFn6);


////////////// CF3x4 FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, CF3x4_CodonFreqs_global, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("cf3x4_global_hyout.txt", LikFn7);

