#!/bin/bash
#$ -N gc_content
#$ -e e_$JOB_NAME
#$ -o o_$JOB_NAME
#$ -S /bin/bash
#$ -q wilke
#$ -m beas
#$ -t 1-100:1
#$ -pe serial 2 # since might overload compute node, apparently.

source ~/.bash_profile

# INPUT ARGS VARIABLES
MU=1e-6
BL=0.005
KAPPA=1
SEQLEN=1000000
GC=3# range from 3,6 in increments of 1 (yields gc content from 20-80%)



# Set up directories
SIMDIR=/home/sjs3495/MutSel/Simulator/src
SCRIPTDIR=/home/sjs3495/Omega_MutSel/cluster_scripts
WDIR=/state/partition1/sjs3495/$JOB_NAME-$JOB_ID-$SGE_TASK_ID
RDIR=/home/sjs3495/$JOB_NAME

mkdir -p $WDIR
if [ ! -d $WDIR ]
then
  echo $WDIR not created
  exit
fi
cd $WDIR

# Copy files
cp -r $SIMDIR .
cp /home/sjs3495/Omega_MutSel/cluster_scripts/run_gc.py .
cp /home/sjs3495/Omega_MutSel/cluster_scripts/functions_simandinf.py .

#Paml
cp /home/sjs3495/bin/codeml .
cp /home/sjs3495/Omega_MutSel/SelectionInference/paml/codeml_raw.txt .


# Run
module load python
python run_gc.py $SGE_TASK_ID $MU $KAPPA $BL $SEQLEN $GC

# Cleanup
mkdir -p $RDIR
cp params* $RDIR
cp pamloutfile $RDIR/pamloutfile-$SGE_TASK_ID-$GC.txt
#cp codonFreqs* $RDIR
rm -rf $WDIR






