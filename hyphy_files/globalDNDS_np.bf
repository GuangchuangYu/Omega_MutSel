/* SJS 9/9/14 - 9/10/14.
Hyphy inference for an "experimental" dataset. Name of file indicates the mutation scheme.
Perform 7 inferences for each of the following parameterizations: Fequal, F61_true, F61_data, F3x4_true, F61_data, Fnuc_true, Fnuc_data. The _data refers to empirical frequencies, whereas _true refers to frequencies in absence of selection. 
Also note that Fnuc is not so much a frequency parameterization, but actually a "new" model.
*/


global w;
global k;
global t;

LIKELIHOOD_FUNCTION_OUTPUT = 1;
RANDOM_STARTING_PERTURBATIONS = 1;
#include "GY94.mdl"; // Basic GY94 rate matrix
#include "fnuc.mdl"; // Custom Fnuc matrices for this run

/* Read in the data */
DataSet	raw_data = ReadDataFile("temp.fasta");

/* Filter the data to find and remove any stop codons*/
DataSetFilter   filt_data = CreateFilter(raw_data,3,"", "","TAA,TAG,TGA");


/* Set up frequencies. MANY OF THESE WERE HARD-CODED IN WHEN THIS FILE WAS CREATED!!!*/

Fequal = {{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623},{0.016393442623}};

F61_true = {{0.0159744555101},{0.0162616273648},{0.0162584125995},{0.015950404186},{0.0162616273648},{0.0165554372266},{0.0165599318572},{0.0162499968371},{0.0162584125995},{0.0165599318572},{0.0165258239283},{0.0162427541962},{0.015950404186},{0.0162499968371},{0.0162427541962},{0.0159498055864},{0.0159810637454},{0.0165160769394},{0.0162769960766},{0.0161666474214},{0.0165160769394},{0.0168416529064},{0.016823753332},{0.0165250436193},{0.0162769960766},{0.016823753332},{0.0166148969851},{0.0164766049448},{0.0161666474214},{0.0165250436193},{0.0164766049448},{0.0162143431321},{0.016425557835},{0.0165924095857},{0.0167029140915},{0.0162690420722},{0.0165924095857},{0.0168721422871},{0.0168940590607},{0.016559997581},{0.0167029140915},{0.0168940590607},{0.0168842653373},{0.0165622079158},{0.0162690420722},{0.016559997581},{0.0165622079158},{0.0162529412102},{0.0163380426741},{0.0158455302574},{0.0163380426741},{0.0165636807244},{0.0166423313189},{0.0162419356376},{0.0166423313189},{0.0161273090386},{0.0161881807798},{0.0158455302574},{0.0162419356376},{0.0161881807798},{0.0159268238491}};

F61_data = {{0.0173880423911},{0.0164372409044},{0.0176845917926},{0.016179443123},{0.0165702162599},{0.0168751388119},{0.0168612911336},{0.0165827548563},{0.0199979635366},{0.0180027537136},{0.0203125372928},{0.0176880736391},{0.0163758084812},{0.0167143522038},{0.0173526899538},{0.0164437371434},{0.0156511101308},{0.0130772197091},{0.0159224609163},{0.0128498732629},{0.0106227264548},{0.0108344522986},{0.01081450703},{0.0106444749742},{0.0197901564963},{0.0202601728735},{0.0202050806618},{0.0199553363572},{0.0171833970119},{0.0175374850869},{0.0175077803752},{0.0172743615653},{0.0157897439053},{0.013556624406},{0.0160378523109},{0.0133340555461},{0.0196892065367},{0.0200289084326},{0.0200352555623},{0.019673148356},{0.0185637905668},{0.0188040208476},{0.0187655715723},{0.0184725385329},{0.0156897236367},{0.0159838890203},{0.0159669587933},{0.0157103221199},{0.0125903322176},{0.0122313072727},{0.0178324018031},{0.0180708983565},{0.0181472935433},{0.0177427793393},{0.0138471019339},{0.0108928661228},{0.0135039399668},{0.0168857823934},{0.0137964123905},{0.0172136423613},{0.0135464017113}};

F3x4_true = {{0.0139509930507},{0.0162487180251},{0.0151906998939},{0.0159166873802},{0.0162487180251},{0.0189248777129},{0.0176926042671},{0.0185381617061},{0.0151906998939},{0.0176926042671},{0.0165405690067},{0.0173310688651},{0.0159166873802},{0.0185381617061},{0.0173310688651},{0.0181593479574},{0.0141210767902},{0.0164468145128},{0.0153758975378},{0.0161107359114},{0.0164468145128},{0.0191556006413},{0.0179083039155},{0.0187641699805},{0.0153758975378},{0.0179083039155},{0.0167422236},{0.0175423608492},{0.0161107359114},{0.0187641699805},{0.0175423608492},{0.0183807379184},{0.014248432894},{0.0165951461343},{0.0155145707023},{0.0162560364849},{0.0165951461343},{0.0193283624428},{0.0180698165145},{0.0189334015212},{0.0155145707023},{0.0180698165145},{0.0168932194765},{0.0177005730566},{0.0162560364849},{0.0189334015212},{0.0177005730566},{0.0185465113366},{0.0131919478809},{0.0129223800938},{0.0131919478809},{0.0153646583106},{0.0143642047951},{0.0150506927782},{0.0143642047951},{0.0134288947546},{0.014070682797},{0.0129223800938},{0.0150506927782},{0.014070682797},{0.0147431429012}};

F3x4_data = {{0.0142519897201},{0.0153529026809},{0.0151914430195},{0.0150784095804},{0.0178227082998},{0.0191994459308},{0.0189975338817},{0.018856180846},{0.0183714337539},{0.0197905583761},{0.0195824298598},{0.0194367248476},{0.017833448029},{0.0192110152639},{0.0190089815452},{0.0188675433321},{0.0128478822995},{0.0138403332077},{0.0136947805679},{0.0135928831943},{0.0160668133356},{0.0173079146405},{0.0171258949862},{0.0169984680654},{0.0165614783042},{0.0178407906299},{0.0176531669554},{0.0175218168152},{0.0160764949856},{0.0173183441618},{0.0171362148248},{0.0170087111183},{0.0141818756196},{0.015277372528},{0.0151167071837},{0.015004229824},{0.0177350276892},{0.0191049923205},{0.0189040735981},{0.0187634159629},{0.018281053633},{0.0196931967285},{0.0194860921215},{0.0193411039197},{0.0177457145832},{0.0191165047371},{0.0189154649437},{0.0187747225501},{0.010861819815},{0.0106676223619},{0.0126091495655},{0.0135831592619},{0.0134403112063},{0.0133403072373},{0.0140013575013},{0.0138541114405},{0.0137510285498},{0.0126167476728},{0.0135913442947},{0.0134484101607},{0.0133483459306}};


/* Optimize likelihoods for each frequency specification */

////////////// FEQUAL FREQUENCIES //////////////
Model MyModel = (GY94, Fequal, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn1 = (filt_data, Tree01);
Optimize (paramValues, LikFn1);
fprintf ("fequal_hyout.txt", LikFn1);


////////////// F61_TRUE FREQUENCIES //////////////
Model MyModel = (GY94, F61_true, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn2 = (filt_data, Tree01);
Optimize (paramValues, LikFn2);
fprintf ("f61_true_hyout.txt", LikFn2);



////////////// F61_DATA FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F61_data, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn3 = (filt_data, Tree01);
Optimize (paramValues, LikFn3);
fprintf ("f61_data_hyout.txt", LikFn3);



////////////// F3x4_TRUE FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_true, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn4 = (filt_data, Tree01);
Optimize (paramValues, LikFn4);
fprintf ("f3x4_true_hyout.txt", LikFn4);


////////////// F3x4_DATA FREQUENCIES //////////////
global w;
global k;
global t;
Model MyModel = (GY94, F3x4_true, 1);
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn5 = (filt_data, Tree01);
Optimize (paramValues, LikFn5);
fprintf ("f3x4_data_hyout.txt", LikFn5);



Fones =  {{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1},{1}};
////////////// Fnuc_TRUE MODEL //////////////
global w;
global k;
global t;
Model MyModel = (GY94_Fnuc_true, Fones, 0); // Using 0 as last argument means that the matrix will *not* be multipled by frequencies, but just in case it is, we provide Fones (all entries are 1, so multiplication is basically..not)
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn6 = (filt_data, Tree01);
Optimize (paramValues, LikFn6);
fprintf ("fnuc_true_hyout.txt", LikFn6);


////////////// Fnuc_DATA MODEL //////////////
global w;
global k;
global t;
Model MyModel = (GY94_Fnuc_data, Fones, 0); // Using 0 as last argument means that the matrix will *not* be multipled by frequencies, but just in case it is, we provide Fones (all entries are 1, so multiplication is basically..not)
UseModel (USE_NO_MODEL);
UseModel(MyModel);
Tree    Tree01 = DATAFILE_TREE;
LikelihoodFunction  LikFn7 = (filt_data, Tree01);
Optimize (paramValues, LikFn7);
fprintf ("fnuc_data_hyout.txt", LikFn7);
